<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ“˜ ä½œæ¥­ç¹³äº¤çµ±è¨ˆè¡¨ç”Ÿæˆå™¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body {
  font-family: "Microsoft JhengHei", sans-serif;
  background: linear-gradient(to bottom right, #e8f0fe, #f8fbff);
  padding: 40px;
  color: #333;
  text-align: center;
}
h1 { color: #1976d2; margin-bottom: 10px; }
h3 { color: #1565c0; margin-top: 30px; }
button, input[type="file"], textarea {
  padding: 8px 14px;
  margin: 6px 4px;
  border-radius: 6px;
  font-size: 14px;
  transition: 0.2s ease;
}
button, input[type="file"] {
  border: none;
  background: #1976d2;
  color: white;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
button:hover, input[type="file"]:hover {
  background: #0f56a0;
  transform: scale(1.03);
}
textarea {
  width: 70%;
  height: 60px;
  border: 1px solid #ccc;
  border-radius: 6px;
  resize: vertical;
  padding: 6px;
  font-family: "Microsoft JhengHei";
  background: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
table {
  border-collapse: collapse;
  margin: 25px auto;
  background: white;
  width: 85%;
  max-width: 900px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th {
  background: #f1f5fb;
  color: #1976d2;
  font-weight: bold;
}
tr:hover td { background: #f9fbff; }
#status { margin-top: 12px; color: #444; font-weight: 500; }
#output { margin-top: 15px; overflow-x: auto; }
.hidden { display: none; }
#exportExcel {
  background: #43a047;
}
#exportExcel:hover {
  background: #2e7d32;
}
</style>
</head>
<body>

<h1>ğŸ“˜ ä½œæ¥­ç¹³äº¤çµ±è¨ˆè¡¨</h1>
<p>è¼¸å…¥å­¸è™Ÿ â†’ ä¸Šå‚³ç­ç´šè³‡æ–™å¤¾ â†’ åŒ¯å‡º Excel</p>

<h3>ç¬¬ 1 æ­¥ï¼šè¼¸å…¥å­¸ç”Ÿå­¸è™Ÿ</h3>
<textarea id="studentInput" placeholder="ä¾‹ï¼š11110134,11207340 11410101 11410102"></textarea><br>
<button id="confirmStudents">âœ… ç¢ºèªå­¸è™Ÿ</button>
<p id="studentCount"></p>

<h3 class="hidden" id="step2">ç¬¬ 2 æ­¥ï¼šä¸Šå‚³ç­ç´šè³‡æ–™å¤¾</h3>
<input type="file" id="classFolderInput" webkitdirectory class="hidden">
<button id="exportExcel" class="hidden">ğŸ“Š ä¸‹è¼‰ Excel çµ±è¨ˆè¡¨</button>

<div id="status"></div>
<div id="output"></div>

<script>
let studentIDs = [];
const data = {};

document.getElementById("confirmStudents").addEventListener("click", () => {
  const text = document.getElementById("studentInput").value.trim();
  if (!text) { alert("è«‹è¼¸å…¥è‡³å°‘ä¸€å€‹å­¸è™Ÿã€‚"); return; }

  studentIDs = text.split(/[\s,;]+/).map(s => s.trim()).filter(Boolean);
  studentIDs = [...new Set(studentIDs)];
  if (studentIDs.length === 0) { alert("âš ï¸ æœªè§£æåˆ°ä»»ä½•å­¸è™Ÿã€‚"); return; }

  document.getElementById("studentCount").innerText = `âœ… å·²è¼¸å…¥ ${studentIDs.length} ä½å­¸ç”Ÿ`;
  document.getElementById("step2").classList.remove("hidden");
  document.getElementById("classFolderInput").classList.remove("hidden");
});

document.getElementById("classFolderInput").addEventListener("change", (e) => {
  const files = Array.from(e.target.files);
  if (files.length === 0) return;

  // âœ… è‡ªå‹•åµæ¸¬è³‡æ–™å¤¾éšå±¤ï¼ŒåªæŠ“å–å­è³‡æ–™å¤¾ï¼Œä¸åŒ…å«æ ¹ç›®éŒ„æª”æ¡ˆ
  files.forEach(file => {
    const pathParts = file.webkitRelativePath.split("/");
    if (pathParts.length < 2) return; // å¿½ç•¥æ ¹ç›®éŒ„æª”æ¡ˆ
    if (pathParts[1].includes(".")) return; // å¦‚æœç¬¬äºŒå±¤æœ‰å‰¯æª”åï¼ˆéè³‡æ–™å¤¾ï¼‰ä¹Ÿå¿½ç•¥
    const folderName = pathParts[1]; // ç¬¬äºŒå±¤ç‚ºä½œæ¥­è³‡æ–™å¤¾å
    const fileName = file.name.split(".")[0];
    if (!data[folderName]) data[folderName] = new Set();
    data[folderName].add(fileName);
  });

  document.getElementById("status").innerText =
    `âœ… å·²è®€å– ${Object.keys(data).length} å€‹ä½œæ¥­è³‡æ–™å¤¾`;
  updatePreview();
});

function updatePreview() {
  const sortedFolders = Object.keys(data).sort();
  const sortedIDs = [...studentIDs].sort();

  let html = "<table><tr><th>å­¸è™Ÿ</th>";
  sortedFolders.forEach(f => html += `<th>${f}</th>`);
  html += "</tr>";

  const outputData = [];
  sortedIDs.forEach(id => {
    let row = [id];
    html += `<tr><td>${id}</td>`;
    sortedFolders.forEach(folder => {
      const match = [...data[folder]].some(name => name.includes(id));
      const val = match ? "âœ…" : "âŒ";
      html += `<td>${val}</td>`;
      row.push(match ? 1 : 0);
    });
    html += "</tr>";
    outputData.push(row);
  });
  html += "</table>";

  document.getElementById("output").innerHTML = html;
  document.getElementById("exportExcel").classList.remove("hidden");

  document.getElementById("exportExcel").onclick = () => {
    const ws_data = [["å­¸è™Ÿ", ...sortedFolders], ...outputData];
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(ws_data);

    // å¾®è»Ÿæ­£é»‘é«” 12pt
    for (const cell in ws) {
      if (ws[cell] && ws[cell].v !== undefined) {
        if (!ws[cell].s) ws[cell].s = {};
        ws[cell].s.font = { name: "Microsoft JhengHei", sz: 12 };
      }
    }

    XLSX.utils.book_append_sheet(wb, ws, "ä½œæ¥­çµ±è¨ˆ");

    // è‡ªè¨‚æª”å
    let filename = prompt("è«‹è¼¸å…¥è¦å„²å­˜çš„æª”åï¼ˆä¸éœ€å‰¯æª”åï¼‰", "ä½œæ¥­ç¹³äº¤çµ±è¨ˆ");
    if (!filename || !filename.trim()) filename = "ä½œæ¥­ç¹³äº¤çµ±è¨ˆ";
    XLSX.writeFile(wb, `${filename}.xlsx`);
  };
}
</script>

</body>
</html>
